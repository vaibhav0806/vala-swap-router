groups:
  - name: vala_swap_router_alerts
    rules:
      # Alert when P95 latency exceeds 350ms
      - alert: HighAPILatency
        expr: histogram_quantile(0.95, rate(vala_swap_request_duration_seconds_bucket[5m])) > 0.35
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "API P95 latency exceeds 350ms"
          description: "P95 latency is {{ $value }}s for endpoint {{ $labels.route }}"

      # Alert when P99 latency exceeds 500ms
      - alert: VeryHighAPILatency
        expr: histogram_quantile(0.99, rate(vala_swap_request_duration_seconds_bucket[5m])) > 0.5
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "API P99 latency exceeds 500ms"
          description: "P99 latency is {{ $value }}s for endpoint {{ $labels.route }}"

      # Alert when error rate is high
      - alert: HighErrorRate
        expr: rate(vala_swap_errors_total[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }} errors/second"

      # Alert when cache hit ratio is low
      - alert: LowCacheHitRatio
        expr: rate(vala_swap_cache_hits_total[5m]) / (rate(vala_swap_cache_hits_total[5m]) + rate(vala_swap_cache_misses_total[5m])) < 0.7
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Cache hit ratio is low"
          description: "Cache hit ratio is {{ $value | humanizePercentage }} for cache type {{ $labels.cache_type }}"
